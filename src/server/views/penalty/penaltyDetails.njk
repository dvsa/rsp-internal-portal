{% extends 'layouts/default.layout.njk' %}

{% set pageTitle = 'DVSA Road Side Payment Portal' %}
{% set pageBreadcrumbItems = [
    { text: 'Home', url: '/' },
    { text: 'Penalty Details' }
  ] 
%}
{# This is going to be refactored once the Payment service is integrated and we have full knowledge of the payload
   coming from it.
#}
{% set paid = true if status == 'Paid' else false %}
{% set statusClass = 'confirmed' if paid else 'unconfirmed' %}

{% block content %}
  
  {% call components.gridRow() %}
    {% call components.columnTwoThirds() %}

      {% call components.form(action="/cpms-step-1", method='get') %}
      {% if paid == false %}
        {{ components.heading(text='Take payments for DVSA penalties', tag='h1', size='xlarge') }}
      {% else %}
        {{ components.heading(text='Penalty payment confirmation', tag='h1', size='xlarge') }}
        <p>You paid a penalty for the payment code:&nbsp;<b>{{ code }}</b>
        {{ components.paragraph(text='A confirmation has been sent to the DVSA location where the penalty has been issued.') }}
      {% endif %}
        <table class="grey-table">
          <caption class="heading-medium">Penalty Details</caption>
          <tbody>
            <tr class="highlighted-row {{ statusClass }}">
              <td>Status:</td>
              <td>{{ status }} {% if paid %} &nbsp;&nbsp;<img src="{{ assets }}/images/icon-check.svg" /> {% endif %} </td>
            </tr>
            <tr>
              <td>Payment Code:</td>
              <td>{{ code }}</td>
            </tr>
            <tr>
              <td>Penalty Type:</td>
              <td>{{ type }}</td>
            </tr>
            <tr>
              <td>Amount:</td>
              <td>{{ amount }}</td>
            </tr>
            <tr>
              <td>Reference:</td>
              <td>{{ reference }}</td>
            </tr>
            <tr>
              <td>Vehicle Registration:</td>
              <td>{{ vehicle_reg }}</td>
            </tr>
            <tr>
              <td>Penalty issued on:</td>
              <td>{{ issue_date }}</td>
            </tr>
            <tr>
              <td>Location:</td>
              <td>{{ location }}</td>
            </tr>
          </tbody>
        </table>
        {% if paid %}
        <p>
          <table class="grey-table">
              <caption class="heading-medium">Payment Details</caption>
            <tbody>
              <tr class="highlighted-row {{ statusClass }}">
                <td>Confirmation code:</td>
                <td>{{ payment.confirmation_code }}</td>
              </tr>
              <tr>
                <td>Receipt number:</td>
                <td>{{ payment.receipt_number }}</td>
              </tr>
              <tr>
                <td>Authorisation code:</td>
                <td>{{ payment.authorisation_code }}</td> 
              </tr>
            </tbody>
          </table>
        </p>
        {% else %}
          {% call components.formGroup() %}
            {{ components.heading(text='Payment by', tag='h3', size='medium') }}
            {{ components.radio(text='Card (external website)', value='card', id='pay-by-card', name='payment_type', checked=true) }}
            {{ components.radio(text='Cash', value='cash', id='pay-by-cash', name='payment_type') }}
            {{ components.radio(text='Cheque', value='cheque', id='pay-by-cheque', name='payment_type') }}
            {{ components.field(label='amount', labelVisuallyHidden=true, id='amount', name='amount', value=amount, type='hidden') }}
            
          {%- endcall %}
        {% endif %}
        {% if paid %}
          
        {% else %}
          {{ components.button(text='Continue to payment', type='submit') }}
        {% endif %}
      {%- endcall %}
    {%- endcall %}

    {% call components.columnOneThird() %}

    <aside class="govuk-related-items" role="complementary">
        Other actions
        <nav role="navigation" aria-labelledby="subsection-title">
          <ul class="font-xsmall">
            <li> {{ components.link(text='Resend penalty details via SMS', url='#') }} </li>
            <li> {{ components.link(text='Resend penalty details via email', url='#') }} </li>
          </ul>
        </nav>
      </aside>
    {%- endcall %}

  {%- endcall %}
  
{% endblock %}